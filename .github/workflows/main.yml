  - name: Use Node.js
    uses: actions/setup-node@v4
    with:
      node-version: '20'

  - name: Install dependencies
    run: npm ci

  - name: Build
    run: npm run build

  - id: set-path
    name: Determine build output path
    run: |
      # Prefer a folder named 'ux-anti-patterns' (in case vite build.outDir is set to that),
      # fall back to 'dist' (Vite default) and finally fall back to repository root.
      if [ -d "ux-anti-patterns" ]; then
        echo "path=ux-anti-patterns" >> $GITHUB_OUTPUT
      elif [ -d "dist" ]; then
        echo "path=dist" >> $GITHUB_OUTPUT
      else
        echo "path=." >> $GITHUB_OUTPUT
      fi

  - name: Upload artifact for GitHub Pages
    uses: actions/upload-pages-artifact@v1
    with:
      path: ${{ steps.set-path.outputs.path }}
